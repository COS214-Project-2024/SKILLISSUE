<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SKILLISSUE: Putting It All Together</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SKILLISSUE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Putting It All Together </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Now we'll look at the (rather long) <code>update</code> function. We'll split it into several parts</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classCity.html#a1a574d77329aae04d530ba6c51171454">City::update</a>(<span class="keywordtype">float</span> dt)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> popTotal = 0;</div>
<div class="line">    <span class="keywordtype">double</span> commercialRevenue = 0;</div>
<div class="line">    <span class="keywordtype">double</span> industrialRevenue = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Update the game time */</span></div>
<div class="line">    this-&gt;<a class="code" href="classCity.html#a5e79133e3088e10db733ab9f58d090d3">currentTime</a> += dt;</div>
<div class="line">    <span class="keywordflow">if</span>(this-&gt;currentTime &lt; this-&gt;<a class="code" href="classCity.html#abbe7b0ece0caee8c6e5a030b7b979f02">timePerDay</a>) <span class="keywordflow">return</span>;</div>
<div class="line">    ++<a class="code" href="classCity.html#af34dc53557663e266d39aefcbe9420a2">day</a>;</div>
<div class="line">    this-&gt;<a class="code" href="classCity.html#a5e79133e3088e10db733ab9f58d090d3">currentTime</a> = 0.0;</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classCity.html#af34dc53557663e266d39aefcbe9420a2">day</a> % 30 == 0)</div>
<div class="line">    {</div>
<div class="line">        this-&gt;<a class="code" href="classCity.html#a0cabd36d33de31539d7dfd5938176680">funds</a> += this-&gt;<a class="code" href="classCity.html#aae272224cc69360ad5505c8f8c9b2f46">earnings</a>;</div>
<div class="line">        this-&gt;<a class="code" href="classCity.html#aae272224cc69360ad5505c8f8c9b2f46">earnings</a> = 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* Run first pass of tile updates. Mostly handles pool distribution */</span></div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; this-&gt;<a class="code" href="classCity.html#ab573f06c1a0423314c701b6290200b21">map</a>.<a class="code" href="classMap.html#aed046be00bb2ea81ada68185c7e44063">tiles</a>.size(); ++i)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classTile.html">Tile</a>&amp; tile = this-&gt;<a class="code" href="classCity.html#ab573f06c1a0423314c701b6290200b21">map</a>.<a class="code" href="classMap.html#aed046be00bb2ea81ada68185c7e44063">tiles</a>[this-&gt;<a class="code" href="classCity.html#a810d7c95486ae2572256d3c55dff78da">shuffledTiles</a>[i]];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(tile.<a class="code" href="classTile.html#a1c8bdaadbe1006b20b33b74241b455d6">tileType</a> == TileType::RESIDENTIAL)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Redistribute the pool and increase the population total by the tile&#39;s population */</span></div>
<div class="line">            this-&gt;<a class="code" href="classCity.html#ac8f372176b4bf0eed68048186369715c">distributePool</a>(this-&gt;<a class="code" href="classCity.html#a5ae8a7c1c07ed789ebf1c154dbfa7e81">populationPool</a>, tile, this-&gt;<a class="code" href="classCity.html#a357d6fd2e9d8ffcd9fdbcaaccbb7e2bc">birthRate</a> - this-&gt;<a class="code" href="classCity.html#a172bbf57e51edcc2283cc5a96b186368">deathRate</a>);</div>
<div class="line"> </div>
<div class="line">            popTotal += tile.<a class="code" href="classTile.html#a55ce28eec1f1265ae58d1e7d4a7ad1f9">population</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tile.<a class="code" href="classTile.html#a1c8bdaadbe1006b20b33b74241b455d6">tileType</a> == TileType::COMMERCIAL)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Hire people */</span></div>
<div class="line">            <span class="keywordflow">if</span>(rand() % 100 &lt; 15 * (1.0-this-&gt;commercialTax))</div>
<div class="line">                this-&gt;<a class="code" href="classCity.html#ac8f372176b4bf0eed68048186369715c">distributePool</a>(this-&gt;<a class="code" href="classCity.html#ae250434a2a3daab8178557c07383c8d8">employmentPool</a>, tile, 0.00);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tile.<a class="code" href="classTile.html#a1c8bdaadbe1006b20b33b74241b455d6">tileType</a> == TileType::INDUSTRIAL)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">/* Extract resources from the ground */</span></div>
<div class="line">            <span class="keywordflow">if</span>(this-&gt;<a class="code" href="classCity.html#ab573f06c1a0423314c701b6290200b21">map</a>.<a class="code" href="classMap.html#a01af6639790f20ad9dcd4a4c79e4ab2e">resources</a>[i] &gt; 0 &amp;&amp; rand() % 100 &lt; this-&gt;<a class="code" href="classCity.html#a0760a3dc00c4e9f302af2ab9b1a54a74">population</a>)</div>
<div class="line">            {</div>
<div class="line">                ++tile.<a class="code" href="classTile.html#a727838d6e6a89a85bd7f8d2c611b4788">production</a>;</div>
<div class="line">                --this-&gt;<a class="code" href="classCity.html#ab573f06c1a0423314c701b6290200b21">map</a>.<a class="code" href="classMap.html#a01af6639790f20ad9dcd4a4c79e4ab2e">resources</a>[i];</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">/* Hire people */</span></div>
<div class="line">            <span class="keywordflow">if</span>(rand() % 100 &lt; 15 * (1.0-this-&gt;industrialTax))</div>
<div class="line">                this-&gt;<a class="code" href="classCity.html#ac8f372176b4bf0eed68048186369715c">distributePool</a>(this-&gt;<a class="code" href="classCity.html#ae250434a2a3daab8178557c07383c8d8">employmentPool</a>, tile, 0.0);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        tile.<a class="code" href="classTile.html#a07ce694c5b16fc1c5e0a3711e682fa74">update</a>();</div>
<div class="line">    }</div>
<div class="ttc" id="aclassCity_html_a0760a3dc00c4e9f302af2ab9b1a54a74"><div class="ttname"><a href="classCity.html#a0760a3dc00c4e9f302af2ab9b1a54a74">City::population</a></div><div class="ttdeci">double population</div><div class="ttdoc">Total population of the city.</div><div class="ttdef"><b>Definition:</b> City.h:90</div></div>
<div class="ttc" id="aclassCity_html_a0cabd36d33de31539d7dfd5938176680"><div class="ttname"><a href="classCity.html#a0cabd36d33de31539d7dfd5938176680">City::funds</a></div><div class="ttdeci">double funds</div><div class="ttdoc">City's available funds for spending and development.</div><div class="ttdef"><b>Definition:</b> City.h:102</div></div>
<div class="ttc" id="aclassCity_html_a172bbf57e51edcc2283cc5a96b186368"><div class="ttname"><a href="classCity.html#a172bbf57e51edcc2283cc5a96b186368">City::deathRate</a></div><div class="ttdeci">double deathRate</div><div class="ttdoc">Death rate of the city's population per day.</div><div class="ttdef"><b>Definition:</b> City.h:65</div></div>
<div class="ttc" id="aclassCity_html_a1a574d77329aae04d530ba6c51171454"><div class="ttname"><a href="classCity.html#a1a574d77329aae04d530ba6c51171454">City::update</a></div><div class="ttdeci">void update(float dt)</div><div class="ttdoc">Updates the city simulation by advancing time.</div><div class="ttdef"><b>Definition:</b> City.cpp:175</div></div>
<div class="ttc" id="aclassCity_html_a357d6fd2e9d8ffcd9fdbcaaccbb7e2bc"><div class="ttname"><a href="classCity.html#a357d6fd2e9d8ffcd9fdbcaaccbb7e2bc">City::birthRate</a></div><div class="ttdeci">double birthRate</div><div class="ttdoc">Birth rate of the city's population per day.</div><div class="ttdef"><b>Definition:</b> City.h:62</div></div>
<div class="ttc" id="aclassCity_html_a5ae8a7c1c07ed789ebf1c154dbfa7e81"><div class="ttname"><a href="classCity.html#a5ae8a7c1c07ed789ebf1c154dbfa7e81">City::populationPool</a></div><div class="ttdeci">double populationPool</div><div class="ttdoc">Number of residents who are not in a residential zone.</div><div class="ttdef"><b>Definition:</b> City.h:53</div></div>
<div class="ttc" id="aclassCity_html_a5e79133e3088e10db733ab9f58d090d3"><div class="ttname"><a href="classCity.html#a5e79133e3088e10db733ab9f58d090d3">City::currentTime</a></div><div class="ttdeci">float currentTime</div><div class="ttdoc">The current time in the simulation.</div><div class="ttdef"><b>Definition:</b> City.h:38</div></div>
<div class="ttc" id="aclassCity_html_a810d7c95486ae2572256d3c55dff78da"><div class="ttname"><a href="classCity.html#a810d7c95486ae2572256d3c55dff78da">City::shuffledTiles</a></div><div class="ttdeci">std::vector&lt; int &gt; shuffledTiles</div><div class="ttdoc">Vector containing shuffled tile indices for resource distribution.</div><div class="ttdef"><b>Definition:</b> City.h:50</div></div>
<div class="ttc" id="aclassCity_html_aae272224cc69360ad5505c8f8c9b2f46"><div class="ttname"><a href="classCity.html#aae272224cc69360ad5505c8f8c9b2f46">City::earnings</a></div><div class="ttdeci">double earnings</div><div class="ttdoc">Earnings of the city from tax and other sources, calculated monthly.</div><div class="ttdef"><b>Definition:</b> City.h:99</div></div>
<div class="ttc" id="aclassCity_html_ab573f06c1a0423314c701b6290200b21"><div class="ttname"><a href="classCity.html#ab573f06c1a0423314c701b6290200b21">City::map</a></div><div class="ttdeci">Map * map</div><div class="ttdoc">Pointer to the city's map containing all tiles.</div><div class="ttdef"><b>Definition:</b> City.h:87</div></div>
<div class="ttc" id="aclassCity_html_abbe7b0ece0caee8c6e5a030b7b979f02"><div class="ttname"><a href="classCity.html#abbe7b0ece0caee8c6e5a030b7b979f02">City::timePerDay</a></div><div class="ttdeci">float timePerDay</div><div class="ttdoc">Time duration that represents one day in the simulation.</div><div class="ttdef"><b>Definition:</b> City.h:41</div></div>
<div class="ttc" id="aclassCity_html_ac8f372176b4bf0eed68048186369715c"><div class="ttname"><a href="classCity.html#ac8f372176b4bf0eed68048186369715c">City::distributePool</a></div><div class="ttdeci">double distributePool(double &amp;pool, Tile *tile, double rate)</div><div class="ttdoc">Helper function to distribute resources from a pool to a tile.</div></div>
<div class="ttc" id="aclassCity_html_ae250434a2a3daab8178557c07383c8d8"><div class="ttname"><a href="classCity.html#ae250434a2a3daab8178557c07383c8d8">City::employmentPool</a></div><div class="ttdeci">double employmentPool</div><div class="ttdoc">Number of residents who are unemployed but capable of working.</div><div class="ttdef"><b>Definition:</b> City.h:56</div></div>
<div class="ttc" id="aclassCity_html_af34dc53557663e266d39aefcbe9420a2"><div class="ttname"><a href="classCity.html#af34dc53557663e266d39aefcbe9420a2">City::day</a></div><div class="ttdeci">int day</div><div class="ttdoc">The current day in the city's simulation timeline.</div><div class="ttdef"><b>Definition:</b> City.h:105</div></div>
<div class="ttc" id="aclassMap_html_a01af6639790f20ad9dcd4a4c79e4ab2e"><div class="ttname"><a href="classMap.html#a01af6639790f20ad9dcd4a4c79e4ab2e">Map::resources</a></div><div class="ttdeci">std::vector&lt; int &gt; resources</div><div class="ttdoc">Vector representing resource levels on each tile.</div><div class="ttdef"><b>Definition:</b> Map.h:47</div></div>
<div class="ttc" id="aclassMap_html_aed046be00bb2ea81ada68185c7e44063"><div class="ttname"><a href="classMap.html#aed046be00bb2ea81ada68185c7e44063">Map::tiles</a></div><div class="ttdeci">std::vector&lt; Tile * &gt; tiles</div><div class="ttdoc">Vector of pointers to all tiles on the map.</div><div class="ttdef"><b>Definition:</b> Map.h:44</div></div>
<div class="ttc" id="aclassTile_html"><div class="ttname"><a href="classTile.html">Tile</a></div><div class="ttdoc">Base class representing a single tile in the simulation.</div><div class="ttdef"><b>Definition:</b> Tile.h:70</div></div>
<div class="ttc" id="aclassTile_html_a07ce694c5b16fc1c5e0a3711e682fa74"><div class="ttname"><a href="classTile.html#a07ce694c5b16fc1c5e0a3711e682fa74">Tile::update</a></div><div class="ttdeci">void update()</div><div class="ttdoc">Updates the tile's state.</div><div class="ttdef"><b>Definition:</b> Tile.cpp:116</div></div>
<div class="ttc" id="aclassTile_html_a1c8bdaadbe1006b20b33b74241b455d6"><div class="ttname"><a href="classTile.html#a1c8bdaadbe1006b20b33b74241b455d6">Tile::tileType</a></div><div class="ttdeci">TileType tileType</div><div class="ttdoc">Type of tile (e.g., residential, industrial, etc.).</div><div class="ttdef"><b>Definition:</b> Tile.h:114</div></div>
<div class="ttc" id="aclassTile_html_a55ce28eec1f1265ae58d1e7d4a7ad1f9"><div class="ttname"><a href="classTile.html#a55ce28eec1f1265ae58d1e7d4a7ad1f9">Tile::population</a></div><div class="ttdeci">double population</div><div class="ttdoc">Current population residing or employed on this tile.</div><div class="ttdef"><b>Definition:</b> Tile.h:126</div></div>
<div class="ttc" id="aclassTile_html_a727838d6e6a89a85bd7f8d2c611b4788"><div class="ttname"><a href="classTile.html#a727838d6e6a89a85bd7f8d2c611b4788">Tile::production</a></div><div class="ttdeci">float production</div><div class="ttdoc">Production output per worker or customer per day.</div><div class="ttdef"><b>Definition:</b> Tile.h:135</div></div>
</div><!-- fragment --><p>Initially we move to the next day if enough time has passed, much like how <code><a class="el" href="classAnimationHandler.html#a6393ee5494fca5e4c7ced3c542e76b6e" title="Updates the current frame of animation based on the elapsed time.">AnimationHandler::update</a></code> works. If a month has passed then the <code>earnings</code> are added to <code>funds</code> and the <code>earnings</code> reset to 0. The bulk of the <code>update</code> function is a series of loops that iterate over every <code>tile</code> in the <code>map</code> (using <code>shuffledTiles</code> of course). These loops must be separate as the order in which various things happen is important. First people attempt to move from the <code>populationPool</code> into the residential zones, and the population of each zone is adjusted according to the net birth rate. The commercial zones then attempt to hire people, where they will hire more people the lower the <code>commercialTax</code> is. Finally the industrial zones will attempt to hire people too, but will also extract resources from the ground if any are left. (Remember the <code>resources</code> variable in <code><a class="el" href="classMap.html" title="Represents a map composed of tiles within the simulation.">Map</a></code>?) We then call <code>update</code> on the <code>tile</code> to change its <code>tileVariant</code> if necessary (i.e. the population is full).</p>
<div class="fragment"><div class="line"><span class="comment">/* Run second pass. Mostly handles goods manufacture */</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; this-&gt;map.tiles.size(); ++i)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classTile.html">Tile</a>&amp; tile = this-&gt;map.tiles[this-&gt;shuffledTiles[i]];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(tile.<a class="code" href="classTile.html#a1c8bdaadbe1006b20b33b74241b455d6">tileType</a> == TileType::INDUSTRIAL)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> receivedResources = 0;</div>
<div class="line">        <span class="comment">/* Receive resources from smaller and connected zones */</span></div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tile2 : this-&gt;map.tiles)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span>(tile2.regions[0] == tile.<a class="code" href="classTile.html#a953fc8e7b4c488b48f239fe7269c2d5a">regions</a>[0] &amp;&amp; tile2.tileType == TileType::INDUSTRIAL)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span>(tile2.production &gt; 0)</div>
<div class="line">                {</div>
<div class="line">                    ++receivedResources;</div>
<div class="line">                    --tile2.<a class="code" href="classTile.html#a727838d6e6a89a85bd7f8d2c611b4788">production</a>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span>(receivedResources &gt;= tile.<a class="code" href="classTile.html#a0bed0f2bacdc50165f5bcd1a37d1c267">tileVariant</a>+1) <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* Turn resources into goods */</span></div>
<div class="line">        tile.<a class="code" href="classTile.html#a9258c54a952de8371bbff34a835121a8">storedGoods</a> += (receivedResources+tile.<a class="code" href="classTile.html#a727838d6e6a89a85bd7f8d2c611b4788">production</a>)*(tile.<a class="code" href="classTile.html#a0bed0f2bacdc50165f5bcd1a37d1c267">tileVariant</a>+1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassTile_html_a0bed0f2bacdc50165f5bcd1a37d1c267"><div class="ttname"><a href="classTile.html#a0bed0f2bacdc50165f5bcd1a37d1c267">Tile::tileVariant</a></div><div class="ttdeci">int tileVariant</div><div class="ttdoc">Variant for different appearances of the same tile type.</div><div class="ttdef"><b>Definition:</b> Tile.h:117</div></div>
<div class="ttc" id="aclassTile_html_a9258c54a952de8371bbff34a835121a8"><div class="ttname"><a href="classTile.html#a9258c54a952de8371bbff34a835121a8">Tile::storedGoods</a></div><div class="ttdeci">float storedGoods</div><div class="ttdoc">Goods stored by the tile.</div><div class="ttdef"><b>Definition:</b> Tile.h:138</div></div>
<div class="ttc" id="aclassTile_html_a953fc8e7b4c488b48f239fe7269c2d5a"><div class="ttname"><a href="classTile.html#a953fc8e7b4c488b48f239fe7269c2d5a">Tile::regions</a></div><div class="ttdeci">unsigned int regions[1]</div><div class="ttdoc">Region IDs to identify connectivity; first is for transport.</div><div class="ttdef"><b>Definition:</b> Tile.h:120</div></div>
</div><!-- fragment --><p>In the second pass the industrial zones attempt to take any resources from smaller zones that they are connected to via roads or zones (those in the same region) before turning those <code>resource</code>s into <code>storedGoods</code>. Each zone can only recieve 1 resource from every other tile and can only recieve 1 more than its <code>tileVariant</code> in total resources. The larger the <code>tileVariant</code> (and so the larger and more advanced the industrial zone) the more goods it can produce per resource and the more resources it can receive.</p>
<div class="fragment"><div class="line"><span class="comment">/* Run third pass. Mostly handles goods distribution */</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; this-&gt;map.tiles.size(); ++i)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classTile.html">Tile</a>&amp; tile = this-&gt;map.tiles[this-&gt;shuffledTiles[i]];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(tile.<a class="code" href="classTile.html#a1c8bdaadbe1006b20b33b74241b455d6">tileType</a> == TileType::COMMERCIAL)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> receivedGoods = 0;</div>
<div class="line">        <span class="keywordtype">double</span> maxCustomers = 0.0;</div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; tile2 : this-&gt;map.tiles)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span>(tile2.regions[0] == tile.<a class="code" href="classTile.html#a953fc8e7b4c488b48f239fe7269c2d5a">regions</a>[0] &amp;&amp;</div>
<div class="line">                tile2.tileType == TileType::INDUSTRIAL &amp;&amp;</div>
<div class="line">                tile2.storedGoods &gt; 0)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">while</span>(tile2.storedGoods &gt; 0 &amp;&amp; receivedGoods != tile.<a class="code" href="classTile.html#a0bed0f2bacdc50165f5bcd1a37d1c267">tileVariant</a>+1)</div>
<div class="line">                {</div>
<div class="line">                    --tile2.<a class="code" href="classTile.html#a9258c54a952de8371bbff34a835121a8">storedGoods</a>;</div>
<div class="line">                    ++receivedGoods;</div>
<div class="line">                    industrialRevenue += 100 * (1.0-industrialTax);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tile2.regions[0] == tile.<a class="code" href="classTile.html#a953fc8e7b4c488b48f239fe7269c2d5a">regions</a>[0] &amp;&amp;</div>
<div class="line">                tile2.tileType == TileType::RESIDENTIAL)</div>
<div class="line">            {</div>
<div class="line">                maxCustomers += tile2.population;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span>(receivedGoods == tile.<a class="code" href="classTile.html#a0bed0f2bacdc50165f5bcd1a37d1c267">tileVariant</a>+1) <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* Calculate the overall revenue for the tile */</span></div>
<div class="line">        tile.<a class="code" href="classTile.html#a727838d6e6a89a85bd7f8d2c611b4788">production</a> = (receivedGoods*100.0 + rand() % 20) * (1.0-this-&gt;commercialTax);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">double</span> revenue = tile.<a class="code" href="classTile.html#a727838d6e6a89a85bd7f8d2c611b4788">production</a> * maxCustomers * tile.<a class="code" href="classTile.html#a55ce28eec1f1265ae58d1e7d4a7ad1f9">population</a> / 100.0;</div>
<div class="line">        commercialRevenue += revenue;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>In the third and final pass the goods produced by the industrial zones are distributed amongst the commercial zones which then sell the goods. First, any goods in connected industrial zones are moved into the commercial zone producing taxable income for the industrial zones. Any connected residential regions increase the maximum number of customers the commerical zone can recieve. We then calculate the revenue the commercial zones generate from selling the goods.</p>
<div class="fragment"><div class="line">    <span class="comment">/* Adjust population pool for births and deaths */</span></div>
<div class="line">    this-&gt;populationPool = this-&gt;adjustPopulation(this-&gt;populationPool, this-&gt;birthRate - this-&gt;deathRate);</div>
<div class="line">    popTotal += this-&gt;populationPool;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Adjust the employment pool for the changing population */</span></div>
<div class="line">    <span class="keywordtype">float</span> newWorkers = (popTotal - this-&gt;population) * this-&gt;propCanWork;</div>
<div class="line">    newWorkers *= newWorkers &lt; 0 ? -1 : 1;</div>
<div class="line">    this-&gt;employmentPool += newWorkers;</div>
<div class="line">    this-&gt;employable += newWorkers;</div>
<div class="line">    <span class="keywordflow">if</span>(this-&gt;employmentPool &lt; 0) this-&gt;employmentPool = 0;</div>
<div class="line">    <span class="keywordflow">if</span>(this-&gt;employable &lt; 0) this-&gt;employable = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Update the city population */</span></div>
<div class="line">    this-&gt;population = popTotal;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Calculate city income from tax */</span></div>
<div class="line">    this-&gt;earnings = (this-&gt;population - this-&gt;populationPool) * 15 * this-&gt;residentialTax;</div>
<div class="line">    this-&gt;earnings += commercialRevenue * this-&gt;commercialTax;</div>
<div class="line">    this-&gt;earnings += industrialRevenue * this-&gt;industrialTax;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In the last part of <code>update</code> we adjust the <code>populationPool</code> based on the net birth rate, and we add new people to the <code>employmentPool</code> if the total population is different from the population on the previous day. This simulates citizens entering the job market, although of course if the population decreases then the number of employable people will drop too. Finally we tax all the income (as well as the residential zones) and increase <code>earnings</code> by the total amount.</p>
<p>And with that the final class is completed! Now all that's left is to incorporate this into <code><a class="el" href="classGameStateEditor.html" title="Represents the editor state of the game.">GameStateEditor</a></code> and put a <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code> in that class too. Firstly we'll replace the <code>map</code> variable in <code><a class="el" href="classGameStateEditor.html" title="Represents the editor state of the game.">GameStateEditor</a></code> with a <code><a class="el" href="classCity.html" title="Represents a city with its population, tax policies, and economic properties.">City</a></code>, <code>city</code> instead. So now instead of <code>this-&gt;map.tileSize</code> calls (for example) we will have <code>this-&gt;city.map.tileSize</code> calls. (Beware the <code>mapPixelToCoords</code> function if you find and replace <code>map</code> with <code>city.map</code>!) We'll also need to add a <code>guiSystem</code> variable like we did in <code><a class="el" href="classGameStateStart.html" title="Represents the initial state of the game when it starts.">GameStateStart</a></code>. Oh, and remember to include <code>&lt;map&gt;</code>, <code>&lt;string</code>, and <code>"gui.hpp"</code>!</p>
<p>Inside the constructor we should of course replace <code>map.load</code> with the <code><a class="el" href="classCity.html" title="Represents a city with its population, tax policies, and economic properties.">City</a></code> equivalent,</p>
<div class="fragment"><div class="line">this-&gt;city = <a class="code" href="classCity.html">City</a>(<span class="stringliteral">&quot;city&quot;</span>, this-&gt;game-&gt;tileSize, this-&gt;game-&gt;tileAtlas);</div>
<div class="line">this-&gt;city.shuffleTiles();</div>
<div class="ttc" id="aclassCity_html"><div class="ttname"><a href="classCity.html">City</a></div><div class="ttdoc">Represents a city with its population, tax policies, and economic properties.</div><div class="ttdef"><b>Definition:</b> City.h:35</div></div>
</div><!-- fragment --><p>And we'll also need to add the <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code> system. This one will be considerably longer than in <code><a class="el" href="classGameStateStart.html" title="Represents the initial state of the game when it starts.">GameStateStart</a></code>!</p>
<div class="fragment"><div class="line"><span class="comment">/* Create gui elements */</span></div>
<div class="line">this-&gt;guiSystem.emplace(<span class="stringliteral">&quot;rightClickMenu&quot;</span>, <a class="code" href="classGui.html">Gui</a>(sf::Vector2f(196, 16), 2, <span class="keyword">false</span>, this-&gt;game-&gt;stylesheets.at(<span class="stringliteral">&quot;button&quot;</span>),</div>
<div class="line">    {</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;Flatten $&quot;</span>          + this-&gt;game-&gt;tileAtlas[<span class="stringliteral">&quot;grass&quot;</span>].getCost(),         <span class="stringliteral">&quot;grass&quot;</span>),</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;Forest $&quot;</span>           + this-&gt;game-&gt;tileAtlas[<span class="stringliteral">&quot;forest&quot;</span>].getCost(),        <span class="stringliteral">&quot;forest&quot;</span> ),</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;Residential Zone $&quot;</span> + this-&gt;game-&gt;tileAtlas[<span class="stringliteral">&quot;residential&quot;</span>].getCost(),   <span class="stringliteral">&quot;residential&quot;</span>),</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;Commercial Zone $&quot;</span>  + this-&gt;game-&gt;tileAtlas[<span class="stringliteral">&quot;commercial&quot;</span>].getCost(),    <span class="stringliteral">&quot;commercial&quot;</span>),</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;Industrial Zone $&quot;</span>  + this-&gt;game-&gt;tileAtlas[<span class="stringliteral">&quot;industrial&quot;</span>].getCost(),    <span class="stringliteral">&quot;industrial&quot;</span>),</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;Road $&quot;</span>             + this-&gt;game-&gt;tileAtlas[<span class="stringliteral">&quot;road&quot;</span>].getCost(),          <span class="stringliteral">&quot;road&quot;</span>)</div>
<div class="line">    }));</div>
<div class="line"> </div>
<div class="line">this-&gt;guiSystem.emplace(<span class="stringliteral">&quot;selectionCostText&quot;</span>, <a class="code" href="classGui.html">Gui</a>(sf::Vector2f(196, 16), 0, <span class="keyword">false</span>, this-&gt;game-&gt;stylesheets.at(<span class="stringliteral">&quot;text&quot;</span>),</div>
<div class="line">    { std::make_pair(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>) }));</div>
<div class="line"> </div>
<div class="line">this-&gt;guiSystem.emplace(<span class="stringliteral">&quot;infoBar&quot;</span>, <a class="code" href="classGui.html">Gui</a>(sf::Vector2f(this-&gt;game-&gt;window.getSize().x / 5 , 16), 2, <span class="keyword">true</span>, this-&gt;game-&gt;stylesheets.at(<span class="stringliteral">&quot;button&quot;</span>),</div>
<div class="line">    {</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;time&quot;</span>,          <span class="stringliteral">&quot;time&quot;</span>),</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;funds&quot;</span>,         <span class="stringliteral">&quot;funds&quot;</span>),</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;population&quot;</span>,    <span class="stringliteral">&quot;population&quot;</span>),</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;employment&quot;</span>,    <span class="stringliteral">&quot;employment&quot;</span>),</div>
<div class="line">        std::make_pair(<span class="stringliteral">&quot;current tile&quot;</span>,  <span class="stringliteral">&quot;tile&quot;</span>)</div>
<div class="line">    }));</div>
<div class="line">this-&gt;guiSystem.at(<span class="stringliteral">&quot;infoBar&quot;</span>).setPosition(sf::Vector2f(0, this-&gt;game-&gt;window.getSize().y - 16));</div>
<div class="line">this-&gt;guiSystem.at(<span class="stringliteral">&quot;infoBar&quot;</span>).show();</div>
<div class="ttc" id="aclassGui_html"><div class="ttname"><a href="classGui.html">Gui</a></div><div class="ttdoc">Represents a graphical user interface (GUI) element for menus and interactive lists.</div><div class="ttdef"><b>Definition:</b> Gui.h:21</div></div>
</div><!-- fragment --><p>The <code>"rightClickMenu"</code> will (as its name implies) be shown when the player presses the right mouse button. It will list all of the possible tiles that they can place along with their prices, and when a tile is chosen <code>currentTile</code> will be set to that tile. Any time the player selects tiles, from then on, will cause the selected tiles to be replaced with <code>currentTile</code>. <code>"selectionCostText"</code> will be displayed when the player is selecting tiles, and will tell them how much the tiles they are placing will cost. It will go red if the player does not have enough funds to place the tiles. Lastly <code>"infoBar"</code> will sit and span the bottom of the screen, displaying the game day and other useful information for the player. If we want it to display information we'll have to update that information all the time, so we can put that code inside of <code>update</code></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classGameStateEditor.html#ada8bfb7aeddeb0e36f935cbd2cdebfab">GameStateEditor::update</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> dt)</div>
<div class="line">{</div>
<div class="line">    this-&gt;<a class="code" href="classGameStateEditor.html#acbdbc8ae654e5856d0b716c3748235a0">city</a>.<a class="code" href="classCity.html#a1a574d77329aae04d530ba6c51171454">update</a>(dt);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Update the info bar at the bottom of the screen */</span></div>
<div class="line">    this-&gt;<a class="code" href="classGameStateEditor.html#ac54d4b8fd3fa14d464976d8f7198987e">guiSystem</a>.at(<span class="stringliteral">&quot;infoBar&quot;</span>).setEntryText(0, <span class="stringliteral">&quot;Day: &quot;</span> + std::to_string(this-&gt;<a class="code" href="classGameStateEditor.html#acbdbc8ae654e5856d0b716c3748235a0">city</a>.<a class="code" href="classCity.html#af34dc53557663e266d39aefcbe9420a2">day</a>));</div>
<div class="line">    this-&gt;<a class="code" href="classGameStateEditor.html#ac54d4b8fd3fa14d464976d8f7198987e">guiSystem</a>.at(<span class="stringliteral">&quot;infoBar&quot;</span>).setEntryText(1, <span class="stringliteral">&quot;$&quot;</span> + std::to_string(<span class="keywordtype">long</span>(this-&gt;<a class="code" href="classGameStateEditor.html#acbdbc8ae654e5856d0b716c3748235a0">city</a>.<a class="code" href="classCity.html#a0cabd36d33de31539d7dfd5938176680">funds</a>)));</div>
<div class="line">    this-&gt;<a class="code" href="classGameStateEditor.html#ac54d4b8fd3fa14d464976d8f7198987e">guiSystem</a>.at(<span class="stringliteral">&quot;infoBar&quot;</span>).setEntryText(2, std::to_string(<span class="keywordtype">long</span>(this-&gt;<a class="code" href="classGameStateEditor.html#acbdbc8ae654e5856d0b716c3748235a0">city</a>.<a class="code" href="classCity.html#a0760a3dc00c4e9f302af2ab9b1a54a74">population</a>)) + <span class="stringliteral">&quot; (&quot;</span> + std::to_string(<span class="keywordtype">long</span>(this-&gt;city.getHomeless())) + <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line">    this-&gt;<a class="code" href="classGameStateEditor.html#ac54d4b8fd3fa14d464976d8f7198987e">guiSystem</a>.at(<span class="stringliteral">&quot;infoBar&quot;</span>).setEntryText(3, std::to_string(<span class="keywordtype">long</span>(this-&gt;<a class="code" href="classGameStateEditor.html#acbdbc8ae654e5856d0b716c3748235a0">city</a>.<a class="code" href="classCity.html#a3df2643d5b3164cca82acf26ceffa54d">employable</a>)) + <span class="stringliteral">&quot; (&quot;</span> + std::to_string(<span class="keywordtype">long</span>(this-&gt;city.getUnemployed())) + <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line">    this-&gt;<a class="code" href="classGameStateEditor.html#ac54d4b8fd3fa14d464976d8f7198987e">guiSystem</a>.at(<span class="stringliteral">&quot;infoBar&quot;</span>).setEntryText(4, tileTypeToStr(<a class="code" href="classGameStateEditor.html#a9864dde58f48b929b176afb7edd750ce">currentTile</a>-&gt;<a class="code" href="classTile.html#a1c8bdaadbe1006b20b33b74241b455d6">tileType</a>));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Highlight entries of the right click context menu */</span></div>
<div class="line">    this-&gt;<a class="code" href="classGameStateEditor.html#ac54d4b8fd3fa14d464976d8f7198987e">guiSystem</a>.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).highlight(this-&gt;<a class="code" href="classGameStateEditor.html#ac54d4b8fd3fa14d464976d8f7198987e">guiSystem</a>.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).getEntry(this-&gt;game-&gt;window.mapPixelToCoords(sf::Mouse::getPosition(this-&gt;game-&gt;window), this-&gt;guiView)));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassCity_html_a3df2643d5b3164cca82acf26ceffa54d"><div class="ttname"><a href="classCity.html#a3df2643d5b3164cca82acf26ceffa54d">City::employable</a></div><div class="ttdeci">double employable</div><div class="ttdoc">Total number of citizens eligible for employment.</div><div class="ttdef"><b>Definition:</b> City.h:93</div></div>
<div class="ttc" id="aclassGameStateEditor_html_a9864dde58f48b929b176afb7edd750ce"><div class="ttname"><a href="classGameStateEditor.html#a9864dde58f48b929b176afb7edd750ce">GameStateEditor::currentTile</a></div><div class="ttdeci">Tile * currentTile</div><div class="ttdoc">The tile currently selected in the editor.</div><div class="ttdef"><b>Definition:</b> GameStateEditor.h:70</div></div>
<div class="ttc" id="aclassGameStateEditor_html_ac54d4b8fd3fa14d464976d8f7198987e"><div class="ttname"><a href="classGameStateEditor.html#ac54d4b8fd3fa14d464976d8f7198987e">GameStateEditor::guiSystem</a></div><div class="ttdeci">std::map&lt; std::string, Gui &gt; guiSystem</div><div class="ttdoc">GUI elements for the editor interface.</div><div class="ttdef"><b>Definition:</b> GameStateEditor.h:73</div></div>
<div class="ttc" id="aclassGameStateEditor_html_acbdbc8ae654e5856d0b716c3748235a0"><div class="ttname"><a href="classGameStateEditor.html#acbdbc8ae654e5856d0b716c3748235a0">GameStateEditor::city</a></div><div class="ttdeci">City city</div><div class="ttdoc">Manages the city layout and related functionalities.</div><div class="ttdef"><b>Definition:</b> GameStateEditor.h:51</div></div>
<div class="ttc" id="aclassGameStateEditor_html_ada8bfb7aeddeb0e36f935cbd2cdebfab"><div class="ttname"><a href="classGameStateEditor.html#ada8bfb7aeddeb0e36f935cbd2cdebfab">GameStateEditor::update</a></div><div class="ttdeci">virtual void update(const float dt)</div><div class="ttdoc">Updates the editor state.</div><div class="ttdef"><b>Definition:</b> GameStateEditor.cpp:48</div></div>
</div><!-- fragment --><p>The first entry of the <code>"infobar"</code> will be the game day, the second the <code>city</code>'s funds, the third the population (with the number of homeless in parentheses), the fourth the number of employable people (with the number left unemployed in parentheses), and the fifth the name of the <code>currentTile</code>. We have to first typecast to a <code>long</code> so that we don't get floating point populations appearing (we used a <code>double</code> for ease of calculation but we truncate it here to print the 'real' value). With <code>update</code> done let's make sure that the <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code> is actually drawn to the screen</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classGameStateEditor.html#a080f96d0248a984d7c9fbb2149db4884">GameStateEditor::draw</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> dt)</div>
<div class="line">{</div>
<div class="line">    this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>.clear(sf::Color::Black);</div>
<div class="line"> </div>
<div class="line">    this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>.setView(this-&gt;<a class="code" href="classGameStateEditor.html#afb73d22921131a21ac9f0d5c82f5d92a">guiView</a>);</div>
<div class="line">    this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>.draw(this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a57ba11192994ff8f9e4c4031cb363f6f">background</a>);</div>
<div class="line"> </div>
<div class="line">    this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>.setView(this-&gt;<a class="code" href="classGameStateEditor.html#a140a3091ba9b1354fdc07ef4a2d82190">gameView</a>);</div>
<div class="line">    this-&gt;<a class="code" href="classGameStateEditor.html#acbdbc8ae654e5856d0b716c3748235a0">city</a>.<a class="code" href="classCity.html#ab573f06c1a0423314c701b6290200b21">map</a>.<a class="code" href="classMap.html#a7592f5a84825f8bf13d6b534b60a37b6">draw</a>(this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>, dt);</div>
<div class="line"> </div>
<div class="line">    this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>.setView(this-&gt;<a class="code" href="classGameStateEditor.html#afb73d22921131a21ac9f0d5c82f5d92a">guiView</a>);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keyword">auto</span> gui : this-&gt;<a class="code" href="classGameStateEditor.html#ac54d4b8fd3fa14d464976d8f7198987e">guiSystem</a>) this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>.draw(gui.second);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassGameStateEditor_html_a080f96d0248a984d7c9fbb2149db4884"><div class="ttname"><a href="classGameStateEditor.html#a080f96d0248a984d7c9fbb2149db4884">GameStateEditor::draw</a></div><div class="ttdeci">virtual void draw(const float dt)</div><div class="ttdoc">Draws the editor state to the screen.</div><div class="ttdef"><b>Definition:</b> GameStateEditor.cpp:22</div></div>
<div class="ttc" id="aclassGameStateEditor_html_a140a3091ba9b1354fdc07ef4a2d82190"><div class="ttname"><a href="classGameStateEditor.html#a140a3091ba9b1354fdc07ef4a2d82190">GameStateEditor::gameView</a></div><div class="ttdeci">sf::View gameView</div><div class="ttdoc">The view for displaying the game world in the editor.</div><div class="ttdef"><b>Definition:</b> GameStateEditor.h:39</div></div>
<div class="ttc" id="aclassGameStateEditor_html_afb73d22921131a21ac9f0d5c82f5d92a"><div class="ttname"><a href="classGameStateEditor.html#afb73d22921131a21ac9f0d5c82f5d92a">GameStateEditor::guiView</a></div><div class="ttdeci">sf::View guiView</div><div class="ttdoc">The view for displaying GUI elements.</div><div class="ttdef"><b>Definition:</b> GameStateEditor.h:42</div></div>
<div class="ttc" id="aclassGameState_html_a355a79415b9ef63c2aec1448a99f6e71"><div class="ttname"><a href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">GameState::game</a></div><div class="ttdeci">Game * game</div><div class="ttdoc">Pointer to the main Game instance.</div><div class="ttdef"><b>Definition:</b> GameState.h:25</div></div>
<div class="ttc" id="aclassGame_html_a223de215aeb661cd423ac145756cc730"><div class="ttname"><a href="classGame.html#a223de215aeb661cd423ac145756cc730">Game::window</a></div><div class="ttdeci">sf::RenderWindow window</div><div class="ttdoc">SFML RenderWindow object for displaying the game.</div><div class="ttdef"><b>Definition:</b> Game.h:87</div></div>
<div class="ttc" id="aclassGame_html_a57ba11192994ff8f9e4c4031cb363f6f"><div class="ttname"><a href="classGame.html#a57ba11192994ff8f9e4c4031cb363f6f">Game::background</a></div><div class="ttdeci">sf::Sprite background</div><div class="ttdoc">Background sprite displayed in the game window.</div><div class="ttdef"><b>Definition:</b> Game.h:93</div></div>
<div class="ttc" id="aclassMap_html_a7592f5a84825f8bf13d6b534b60a37b6"><div class="ttname"><a href="classMap.html#a7592f5a84825f8bf13d6b534b60a37b6">Map::draw</a></div><div class="ttdeci">void draw(sf::RenderWindow &amp;window, float dt)</div><div class="ttdoc">Draws the map onto the specified window.</div><div class="ttdef"><b>Definition:</b> Map.cpp:175</div></div>
</div><!-- fragment --><p>First we switch to the <code>guiView</code> and then we draw each <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code> in turn like in <code><a class="el" href="classGameStateStart.html" title="Represents the initial state of the game when it starts.">GameStateStart</a></code>. The <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code> is of course drawn after the <code>city</code>, otherwise the player wouldn't be able to see it! Finally we can add the <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code> code to <code>handleInput</code>. Before we get to the <code>switch</code> statement it would be sensible to save ourselves some writing and create <code>gamePos</code> and <code>guiPos</code> variables that record the position of the mouse in <code>gameView</code> and <code>guiView</code> coordinates</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classGameStateEditor.html#a844fc3ad5c866b250f95b57db88c5a6f">GameStateEditor::handleInput</a>()</div>
<div class="line">{</div>
<div class="line">    sf::Event event;</div>
<div class="line"> </div>
<div class="line">    sf::Vector2f guiPos = this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>.mapPixelToCoords(sf::Mouse::getPosition(this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>), this-&gt;guiView);</div>
<div class="line">    sf::Vector2f gamePos = this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>.mapPixelToCoords(sf::Mouse::getPosition(this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>), this-&gt;gameView);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span>(this-&gt;<a class="code" href="classGameState.html#a355a79415b9ef63c2aec1448a99f6e71">game</a>-&gt;<a class="code" href="classGame.html#a223de215aeb661cd423ac145756cc730">window</a>.pollEvent(event))</div>
<div class="ttc" id="aclassGameStateEditor_html_a844fc3ad5c866b250f95b57db88c5a6f"><div class="ttname"><a href="classGameStateEditor.html#a844fc3ad5c866b250f95b57db88c5a6f">GameStateEditor::handleInput</a></div><div class="ttdeci">virtual void handleInput()</div><div class="ttdoc">Handles user input for the editor.</div><div class="ttdef"><b>Definition:</b> GameStateEditor.cpp:121</div></div>
</div><!-- fragment --><p>Inside of the <code>MouseMoved</code> event we'll add the code to display the <code>"selectionCostText"</code> <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code></p>
<div class="fragment"><div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            this-&gt;city.map.select(selectionStart, selectionEnd,</div>
<div class="line">                {</div>
<div class="line">                    this-&gt;currentTile-&gt;tileType,    TileType::FOREST,</div>
<div class="line">                    TileType::WATER,                TileType::ROAD,</div>
<div class="line">                    TileType::RESIDENTIAL,          TileType::COMMERCIAL,</div>
<div class="line">                    TileType::INDUSTRIAL</div>
<div class="line">                });</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;selectionCostText&quot;</span>).setEntryText(0, <span class="stringliteral">&quot;$&quot;</span> +</div>
<div class="line">        std::to_string(this-&gt;currentTile-&gt;cost * this-&gt;city.map.numSelected));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(this-&gt;city.funds &lt;= this-&gt;city.map.numSelected * this-&gt;currentTile-&gt;cost)</div>
<div class="line">            this-&gt;guiSystem.at(<span class="stringliteral">&quot;selectionCostText&quot;</span>).highlight(0);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            this-&gt;guiSystem.at(<span class="stringliteral">&quot;selectionCostText&quot;</span>).highlight(-1);</div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;selectionCostText&quot;</span>).setPosition(guiPos + sf::Vector2f(16, -16));</div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;selectionCostText&quot;</span>).show();</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* Highlight entries of the right click context menu */</span></div>
<div class="line">    this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).highlight(this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).getEntry(guiPos));</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The total cost is of course the cost per tile multiplied by the number of selected tiles. If the city does not has enough <code>funds</code> we highlight the text, making it red. We then position the text to the bottom right of the cursors and <code>show</code> it. We also <code>highlight</code> the entry of the <code>"rightClickMenu"</code> that the player is hovering over. For the <code>MouseButtonPressed</code> event, we hide the <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code> when the middle mouse button is pressed</p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> sf::Event::MouseButtonPressed:</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Start panning */</span></div>
<div class="line">    <span class="keywordflow">if</span>(event.mouseButton.button == sf::Mouse::Middle)</div>
<div class="line">    {</div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).hide();</div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;selectionCostText&quot;</span>).hide();</div>
</div><!-- fragment --><p>When the left mouse button is pressed we select a tile from the <code>"rightClickMenu"</code> if it is visible, or we start selecting tiles if it isn't</p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span>(event.mouseButton.button == sf::Mouse::Left)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Select a context menu entry */</span></div>
<div class="line">    <span class="keywordflow">if</span>(this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).visible == <span class="keyword">true</span>)</div>
<div class="line">    {</div>
<div class="line">        std::string msg = this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).activate(guiPos);</div>
<div class="line">        <span class="keywordflow">if</span>(msg != <span class="stringliteral">&quot;null&quot;</span>) this-&gt;currentTile = &amp;this-&gt;game-&gt;tileAtlas.at(msg);</div>
<div class="line"> </div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).hide();</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* Select map tile */</span></div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Select map tile */</span></div>
<div class="line">        <span class="keywordflow">if</span>(this-&gt;actionState != ActionState::SELECTING)</div>
<div class="line">        {</div>
<div class="line">            this-&gt;actionState = ActionState::SELECTING;</div>
<div class="line">            selectionStart.x = gamePos.y / (this-&gt;city.map.tileSize)</div>
<div class="line">                + gamePos.x / (2*this-&gt;city.map.tileSize) - this-&gt;city.map.width * 0.5 - 0.5;</div>
<div class="line">            selectionStart.y = gamePos.y / (this-&gt;city.map.tileSize)</div>
<div class="line">                - gamePos.x / (2*this-&gt;city.map.tileSize) + this-&gt;city.map.width * 0.5 + 0.5;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>When we created the <code>"rightClickMenu"</code> we set the <code>message</code>s to be equal to the name of the tile in the <code>tileAtlas</code>, and so we can easily set <code>currentTile</code> to the one clicked. When an entry is selected we <code>hide</code> the menu. Finally, in the <code>MouseButtonPressed</code> event we handle what happens when the right mouse button is pressed</p>
<div class="fragment"><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span>(event.mouseButton.button == sf::Mouse::Right)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Stop selecting */</span></div>
<div class="line">    <span class="keywordflow">if</span>(this-&gt;actionState == ActionState::SELECTING)</div>
<div class="line">    {</div>
<div class="line">        this-&gt;actionState = ActionState::NONE;</div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;selectionCostText&quot;</span>).hide();</div>
<div class="line">        this-&gt;city.map.clearSelected();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Open the tile select menu */</span></div>
<div class="line">        sf::Vector2f pos = guiPos;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(pos.x &gt; this-&gt;game-&gt;window.getSize().x - this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).getSize().x)</div>
<div class="line">        {</div>
<div class="line">            pos -= sf::Vector2f(this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).getSize().x, 0);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>(pos.y &gt; this-&gt;game-&gt;window.getSize().y - this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).getSize().y)</div>
<div class="line">        {</div>
<div class="line">            pos -= sf::Vector2f(0, this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).getSize().y);</div>
<div class="line">        }</div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).setPosition(pos);</div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;rightClickMenu&quot;</span>).show();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p>As before we stop selecting if the right mouse button is pressed, but we also make sure that we hide the <code>"selectionCostText"</code>. If the player isn't selecting then we open the <code>"rightClickMenu"</code>. The <code>if</code> statements make sure that the <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code> is not opened in a position so as to go off the edge of the screen; it will always open with a corner on the mouse cursor, but which corner depends on where the mouse is when the button is pressed. We then set the position of the <code><a class="el" href="classGui.html" title="Represents a graphical user interface (GUI) element for menus and interactive lists.">Gui</a></code> before <code>show</code>ing it.</p>
<p>Next we'll add the code to change the selected tiles. When the left mouse button is released</p>
<div class="fragment"><div class="line"><span class="comment">/* Stop selecting */</span></div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span>(event.mouseButton.button == sf::Mouse::Left)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(this-&gt;actionState == ActionState::SELECTING)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Replace tiles if enough funds and a tile is selected */</span></div>
<div class="line">        <span class="keywordflow">if</span>(this-&gt;currentTile != <span class="keyword">nullptr</span>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cost = this-&gt;currentTile-&gt;cost * this-&gt;city.map.numSelected;</div>
<div class="line">            <span class="keywordflow">if</span>(this-&gt;city.funds &gt;= cost)</div>
<div class="line">            {</div>
<div class="line">                this-&gt;city.bulldoze(*this-&gt;currentTile);</div>
<div class="line">                this-&gt;city.funds -= this-&gt;currentTile-&gt;cost * this-&gt;city.map.numSelected;</div>
<div class="line">                this-&gt;city.tileChanged();</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        this-&gt;guiSystem.at(<span class="stringliteral">&quot;selectionCostText&quot;</span>).hide();</div>
<div class="line">        this-&gt;actionState = ActionState::NONE;</div>
<div class="line">        this-&gt;city.map.clearSelected();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now as well as clearing the selection we hide the <code>"selectionCostText"</code> and replace the selected tiles if the <code>city</code> has enough <code>funds</code> to do so. We also call <code>tileChanged</code> to update the regions and roads.</p>
<p>Lastly we need to readjust the dimensions and position of the <code>"infobar"</code> when the screen is resized</p>
<div class="fragment"><div class="line"><span class="comment">/* Resize the window */</span></div>
<div class="line"><span class="keywordflow">case</span> sf::Event::Resized:</div>
<div class="line">{</div>
<div class="line">    gameView.setSize(event.size.width, event.size.height);</div>
<div class="line">    gameView.zoom(zoomLevel);</div>
<div class="line">    guiView.setSize(event.size.width, event.size.height);</div>
<div class="line">    this-&gt;guiSystem.at(<span class="stringliteral">&quot;infoBar&quot;</span>).setDimensions(sf::Vector2f(event.size.width / this-&gt;guiSystem.at(<span class="stringliteral">&quot;infoBar&quot;</span>).entries.size(), 16));</div>
<div class="line">    this-&gt;guiSystem.at(<span class="stringliteral">&quot;infoBar&quot;</span>).setPosition(this-&gt;game-&gt;window.mapPixelToCoords(sf::Vector2i(0, event.size.height - 16), this-&gt;guiView));</div>
<div class="line">    this-&gt;guiSystem.at(<span class="stringliteral">&quot;infoBar&quot;</span>).show();</div>
<div class="line">    this-&gt;game-&gt;background.setPosition(this-&gt;game-&gt;window.mapPixelToCoords(sf::Vector2i(0, 0), this-&gt;guiView));</div>
<div class="line">    this-&gt;game-&gt;background.setScale(</div>
<div class="line">        <span class="keywordtype">float</span>(event.size.width) / <span class="keywordtype">float</span>(this-&gt;game-&gt;background.getTexture()-&gt;getSize().x),</div>
<div class="line">        <span class="keywordtype">float</span>(event.size.height) / <span class="keywordtype">float</span>(this-&gt;game-&gt;background.getTexture()-&gt;getSize().y));</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This is just the same code as we had in the constructor, but placed in the <code>resize</code> function instead.</p>
<p>Phew, that was a lot of code! Try compiling and playing the game, hopefully it does everything it's supposed to... I hope you enjoyed this adventure into SFML, there's still a lot you can do with this game! Perhaps add some new power station and pylon tiles and create an electricity system (add another region to help distribute the electricity) or make the zones demand water. You could also add some nice background music (use the <a href="http://www.sfml-dev.org/documentation/2.1/group__audio.php"><code>sf::Music</code> class</a>) or add the option to create a new game instead of just continuing from an existing one. Above all, enjoy yourself whilst you do it, and happy programming! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
